# charts/main-ingress/templates/ingress.yaml

{{- if .Values.ingress.enabled -}}
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: main-egi-ingress
  namespace: desarrollo
  annotations:
    # --- ANOTACIÓN CORREGIDA ---
    # La sintaxis es: <namespace>-<nombre-middleware>@kubernetescrd
    traefik.ingress.kubernetes.io/router.middlewares: "desarrollo-strip-airflow-prefix@kubernetescrd, desarrollo-strip-panel-prefix@kubernetescrd"
spec:
  ingressClassName: traefik # Esto está bien, lo dejamos
  rules:
  - http:
      paths:
      # ... (el resto de las reglas de 'paths' se quedan como están) ...
      - path: {{ .Values.paths.static_web.path }}
        pathType: {{ .Values.paths.static_web.pathType }}
        backend:
          service:
            name: {{ .Values.paths.static_web.serviceName }}
            port:
              number: {{ .Values.paths.static_web.servicePort }}
      - path: {{ .Values.paths.panel.path }}
        pathType: {{ .Values.paths.panel.pathType }}
        backend:
          service:
            name: {{ .Values.paths.panel.serviceName }}
            port:
              number: {{ .Values.paths.panel.servicePort }}
      - path: {{ .Values.paths.airflow.path }}
        pathType: {{ .Values.paths.airflow.pathType }}
        backend:
          service:
            name: {{ .Values.paths.airflow.serviceName }}
            port:
              number: {{ .Values.paths.airflow.servicePort }}
{{- end }}